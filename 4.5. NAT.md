### 4.5. NAT [Кулагин Игорь]
**Задание 1.**
>Вы подняли на своём домашнем компьютере с IP-адресом `192.168.0.2` web-сервер.

>* Получится ли у пользователей интернета открыть этот сайт?

Без настройки трансляции адресов не получится, так как сеть 192.168.0.0/16 приватная и не маршрутизируется в сети Интернет.

>* Нужно ли будет вам для этого что-то сделать дополнительно?

Настроить NAT.

>* Существует ли такой набор настроек провайдера, который не позволит подключение?

Если на клиентский маршрутизатор провайдер назначает адрес из пула "серых" (приватных) адресов, то NAT одного приватного адреса в другой не решит проблему доступности ресурса из Интернет. Нужен публичный "белый" IP-адрес.


**Задание 2.**
>- Узел `src` инициировал соединение с узлом `dst`.
>- На маршрутизаторе узла `src` была создана трансляция:

>| src local IP:port | src global IP:port | dst IP | protocol
>| -------- | -------- | -------- | -------- |
>| 10.0.0.2:1111     | 93.15.10.2:2222     | 1.1.1.1:80     |tcp|

>Применив знания по установке TCP сессий, ответьте на вопросы:
>* Сможет ли злоумышленник доставить пакет до `10.0.0.2`, отправив пакет на адрес/порт `93.15.10.2:2222` с адреса `74.5.12.4`?

Не сможет, NAT сработает только если IP злоумышленника 1.1.1.1 и порт tcp/80.

>* А если злоумышленник подменит source IP-адрес и сгенерирует пакет с source IP:port - `1.1.1.1:80`

Давайте предположим, что межсетевой экран пропускает любой входящий и исходящий трафик. В таком случае злоумышленник сможет доставить пакет на 10.0.0.2:1111, но только в том случае, если в таблице NAT уже существует запись об указанной выше трансляции: пакет от злоумышленника будет воспринят как ответ на ранее отправленный пакет. 

**Задание 3.**
>- Узел `src` инициировал соединение с узлом `dst`.
>- На маршрутизаторе узла `src` была создана трансляция:


>| src local IP:port | src global IP:port | dst IP | protocol
>| -------- | -------- | -------- | -------- |
>| 10.0.0.2:1111     | 93.15.10.2:2222     | 8.8.8.8:53     |udp|

>Применив знания по работе UDP, ответьте на вопросы:
>* Сможет ли злоумышленник доставить пакет до `10.0.0.2`, отправив пакет на адрес/порт `93.15.10.2:2222` с адреса `74.5.12.4`?

Не сможет, NAT сработает только если IP злоумышленника 8.8.8.8 и порт udp/53.

>* А если злоумышленник подменит source IP-адрес и сгенерирует пакет с source IP:port - `8.8.8.8:53`

Не вижу принципиальной разницы с трансляцией для TCP. Давайте предположим, что межсетевой экран пропускает любой входящий и исходящий трафик. В таком случае злоумышленник сможет доставить пакет на 10.0.0.2:1111, но только в том случае, если в таблице NAT уже существует запись об указанной выше трансляции: пакет от злоумышленника будет воспринят как ответ на ранее отправленный пакет.

**Задание 4.**
>Найдите самую часто встречающуюся проблему при работе клиентов за NAT с протоколом FTP, связанную с особенностью работы FTP (на лекции по портам эта особенность упоминалась).

>1. В чём выражается проблема?

В активном режиме работы FTP клиент передает серверу управляющую команду PORT, которой указывает на какой порт тот должен установить канал передачи данных. Если клиент находится за NAT в приватной сети, то для корректной работы такого механизма должна существовать соответствующая DNAT-трансляция на пограничном маршрутизаторе, что обычно невозможно, например, в сценарии когда клиент один из сотни хостов в офисной сети за Overload NAT. 

>2. Почему она возникает?

Если клиент находится за NAT в приватной сети, то для корректной работы такого механизма должна существовать соответствующая DNAT-трансляция на пограничном маршрутизаторе, что обычно невозможно, например, в сценарии когда клиент один из сотни хостов в офисной сети за Overload NAT. 

>3. Что можно сделать, чтобы избежать этой проблемы?

Переключение протокола FTP на работу в пассивном режиме, когда сервер указывает клиенту на какой порт устанавливать соединение. В таком случае не требуется заранее создавать DNAT-трансляцию.
