# 05.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения - Кулагин Игорь
### Задача 1
> Опишите кратко, в чём основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

- **Полная (аппаратная) виртуализация** - создает специальный слой абстракции между аппаратными ресурсами и гостевыми ОС. Гостевые ОС "не знают" о существовании гипервизора и работают как-будто с аппаратными ресурсами, но на самом деле взаимодействуют со слоем абстракции гипервизора. Не смотря на преимущество в виде полной изоляции одной гостевой VM от другой, при полной виртуализации возникают дополнительные накладные расходы за счет слоя абстракции.

- **Паравиртуализация** - в этом типе виртуализации гостевые ОС "знают" о виртуально окружении и должны уметь поддерживать работу с ним. Например, для Windows нужны специальные драйверы, а для Linux - поддержка со стороны ядра, хотя де-факто такая поддержка для популярны систем, реализующих паравиртуализацию, уже давно идет из коробки. За счет того, что гостевые ОС могут взаимодействовать с аппаратными ресурсами напрямую, минуя слой абстракции, произвольность паравиртуализации может быть выше, чем полной. Однако то также влечет снижение уровня изоляции гостевых виртуальных машин.

- **Виртуализация на основе операционной системы (ОС)** - происходит на уровне операционной системы, а не напрямую на аппаратном уровне. Как правило речь идет о контейнерной виртуализации. Эти контейнеры используют ядро хостовой операционной системы, однако изолированы друг от друга. Этот тип виртуализации обеспечивает более низкие накладные расходами по сравнению с полной виртуализацией и паравиртуализацией, однако и уровень изоляции между контейнерами самый низкий из рассматриваемых типов виртуализации.

### Задача 2
> Выберите один из вариантов использования организации физических серверов в зависимости от условий использования.

> Организация серверов:

> - физические сервера,
> - паравиртуализация,
> - виртуализация уровня ОС.
> Условия использования:

> - высоконагруженная база данных, чувствительная к отказу;

Можно предложить использовать физические серверы и на их базе построить отказоустойчивый кластер СУБД. Утилизация ресурсов таких серверов представляется высокой из-за того что СУБД будет высоконагруженной (т.е. плюса от виртуализации в виде более высокой утилизации аппаратных ресурсов наблюдаться не будет), а производительность - максимально возможной из-за отсутствия какого-либо слоя виртуализации. Тем не менее виртуализация (я бы выбрал аппаратную виртуализацию, но ее нет в списке доступных для выбора вариантов) также часто используемый на практике вариант для развертывания кластеров нагруженных СУБД из-за удобства работы с виртуальными машинами по сравнению с аппаратными серверами.

> - различные web-приложения;

Виртуализация на уровне ОС (приложения в контейнерах), особенно если речь идет о собственной разработке, так как в этом случае контейнерная виртуализация де-факто стандарт. Если речь о коробочных решениях, которые не поставляются в виде контейнеров - полная или паравиртуализация.

> - Windows-системы для использования бухгалтерским отделом;

Для систем с небольшой и средней нагрузкой - паравиртуализация (я опять бы выбрал аппаратную виртуализацию). Просто поднимаем набор виртуальных машин на базе Windows и на них запускаем финансовую систему. Для высоконагруженных систем особенно на базе 1С часто рекомендуют использовать железные сервера, потому что слой виртуализации может оказывать существенное влияние на производительность 1С.   

> - системы, выполняющие высокопроизводительные расчёты на GPU.

Физические сервера. Идея в том, что для наиболее эффективной работы с железом напрямую, коими представляются расчеты на GPU, лучше всего избегать дополнительных накладных расходов, которые может привнести виртуализация. Использование паравиртуализации не исключено, и решение будет зависеть от условий конкретной задачи.

### Задача 3
> Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

> - 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.

Bare-metal гипервизор (полная виртуализация) на базе VMware vCenter/VMware ESXi. Из плюсов - высокая утилизация аппаратных ресурсов серверов и отличная совместимость как с Windows, так и с Linux гостевыми ОС. Доступно множество проверенных временем и относительно простых в эксплуатации решений для резервного копирования. Из минусов - решение платное.

> - Требуется наиболее производительное бесплатное open source-решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.

KVM в режиме паравиртуализации. Сам KVM прекрасно совместимо с Linux на гостевых ОС, а режим паравиртуализации потенциально может помочь достигнуть большей производительности по сравнения с полной виртуализацией. 

> - Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.

Я бы предложил использовать Microsoft Hyper-V. Так как и Windows, и Hyper-V продукты Microsoft, то будет достигнута максимальная совместимость гипервизора и гостевой ОС. Hyper-V поддерживает оба режима виртуализации: полную (аппаратную) виртуализацию ("Hyper-V Hypervisor) и паравиртуализацию ("Hyper-V Enlightenments"). Потенциально режим паравиртуализации может дать выигрыш по производительности, поэтому выбор конкретного режима нужно будет осуществить на практике после тестирования.

> - Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

VirtualBox - самый простой и бесплатный инструмент для виртуализации, доступный на всех основных ОС. 

### Задача 4
> Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

Не смотря на идентичность общих принципов, детали работы различных платформ виртуализации могут существенно отличаться, и для успешной поддержки таких гетерогенных инсталляций придется иметь экспертизу по каждой из систем виртуализации. Это существенно увеличивает стоимость поддержки и общую сложность ландшафта ИТ-инфраструктуры. Тем не менее, если говорить про разные типы виртуализации, то на практике их совмещение используется повсеместно. Например, часто используют VMware vCenter для полной виртуализации и `conteinerd` для контейнерной (виртуализация на уровне ОС) виртуализации. Если использование различных платформ виртуализации обусловлено бизнес-потребностями, то, конечно, такие потребности придется удовлетворять и строить гетерогенные решения. Для минимизации рисков и проблем, я бы предложил стандартизировать использование платформ для виртуализации каждого типа. Например, принять за стандарт использование VMware ESXi для платформы аппаратной виртуализации, и `conteinerd` для виртуализации на уровне ОС. Это помогло бы "*не плодить сущности*", тем самым уменьшив сложность и стоимость поддержки ландшафта виртуализации.